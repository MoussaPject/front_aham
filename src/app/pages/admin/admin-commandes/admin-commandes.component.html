<section class="p-6 bg-gray-50 min-h-screen space-y-8">

  <!-- ================= HEADER ================= -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div>
      <h1 class="text-3xl font-bold text-gray-800">
        Gestion des commandes
      </h1>
      <p class="text-gray-500 mt-1">
        Supervisez, traitez et suivez les commandes clients
      </p>
    </div>
  </div>

  <!-- ================= STATS ================= -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
    <div class="bg-white rounded-xl p-5 shadow-sm border">
      <p class="text-sm text-gray-500">Total commandes</p>
      <p class="text-2xl font-bold text-gray-800">{{ stats.total }}</p>
    </div>

    <div class="bg-amber-50 rounded-xl p-5 shadow-sm border border-amber-200">
      <p class="text-sm text-amber-600">En attente</p>
      <p class="text-2xl font-bold text-amber-700">{{ stats.enAttente }}</p>
    </div>

    <div class="bg-indigo-50 rounded-xl p-5 shadow-sm border border-indigo-200">
      <p class="text-sm text-indigo-600">En cours</p>
      <p class="text-2xl font-bold text-indigo-700">{{ stats.enCours }}</p>
    </div>

    <div class="bg-emerald-50 rounded-xl p-5 shadow-sm border border-emerald-200">
      <p class="text-sm text-emerald-600">Livrées</p>
      <p class="text-2xl font-bold text-emerald-700">{{ stats.livree }}</p>
    </div>

    <div class="bg-red-50 rounded-xl p-5 shadow-sm border border-red-200">
      <p class="text-sm text-red-600">Annulées</p>
      <p class="text-2xl font-bold text-red-700">{{ stats.annulee }}</p>
    </div>
  </div>

  <!-- ================= FILTERS ================= -->
  <div class="bg-white rounded-xl p-6 shadow-sm border flex flex-col lg:flex-row gap-4 lg:items-center lg:justify-between">

    <div class="flex flex-col sm:flex-row gap-3 w-full">
      <input
        type="text"
        [(ngModel)]="search"
        placeholder="Rechercher par référence ou client"
        class="w-full sm:w-72 px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:outline-none"
      />

      <select
        [(ngModel)]="filterStatus"
        class="w-full sm:w-56 px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:outline-none"
      >
        <option value="">Tous les statuts</option>
        <option value="en attente">En attente</option>
        <option value="en cours">En cours</option>
        <option value="livrée">Livrée</option>
        <option value="annulée">Annulée</option>
      </select>
    </div>

    <div class="flex gap-3">
      <button
        (click)="applyFilters()"
        class="px-5 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition"
      >
        Filtrer
      </button>

      <button
        (click)="resetFilters()"
        class="px-5 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition"
      >
        Réinitialiser
      </button>
    </div>
  </div>

  <!-- ================= TABLE ================= -->
  <div class="bg-white rounded-xl shadow-sm border overflow-hidden">

    <table class="min-w-full text-sm">
      <thead class="bg-gray-100 text-gray-600 uppercase text-xs">
        <tr>
          <th class="px-6 py-4 text-left">Référence</th>
          <th class="px-6 py-4 text-left">Client</th>
          <th class="px-6 py-4 text-left">Statut</th>
          <th class="px-6 py-4 text-left">Total</th>
          <th class="px-6 py-4 text-left">Date</th>
          <th class="px-6 py-4 text-right">Actions</th>
        </tr>
      </thead>

      <tbody class="divide-y">
        <tr
          *ngFor="let c of filteredCommandes"
          class="hover:bg-gray-50 transition"
        >
          <td class="px-6 py-4 font-medium text-gray-800">
            #{{ c.reference || c.id }}
          </td>

          <td class="px-6 py-4 text-gray-600">
            {{ c.user?.name }}
          </td>

          <!-- STATUT BADGE -->
          <td class="px-6 py-4">
            <span
              class="px-3 py-1 rounded-full text-xs font-semibold"
              [ngClass]="{
                'bg-amber-100 text-amber-700': c.statut === 'en attente',
                'bg-indigo-100 text-indigo-700': c.statut === 'en cours',
                'bg-emerald-100 text-emerald-700': c.statut === 'livrée',
                'bg-red-100 text-red-700': c.statut === 'annulée'
              }"
            >
              {{ c.statut }}
            </span>
          </td>

          <td class="px-6 py-4 font-semibold text-gray-800">
            {{ c.total | number:'1.0-0' }} XOF
          </td>

          <td class="px-6 py-4 text-gray-500">
            {{ c.date_commande| date:'shortDate' }}
          </td>

          <!-- ACTIONS -->
          <td class="px-6 py-4 text-right space-x-2">
            <button
              (click)="goToDetail(c)"
              class="px-3 py-1.5 text-indigo-600 hover:bg-indigo-50 rounded-md transition"
            >
              Détails
            </button>

            <select
              class="px-2 py-1 rounded-md border text-xs"
              [disabled]="c.statut === 'livrée' || c.statut === 'annulée'"
              (change)="onChangeStatus(c, $any($event.target).value)"
            >
              <option value="">Changer statut</option>
              <option value="en attente">En attente</option>
              <option value="en cours">En cours</option>
              <option value="livrée">Livrée</option>
              <option value="annulée">Annulée</option>
            </select>

            <button
              (click)="onDelete(c)"
              class="px-3 py-1.5 text-red-600 hover:bg-red-50 rounded-md transition"
            >
              Supprimer
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!filteredCommandes.length" class="p-6 text-center text-gray-500">
      Aucune commande trouvée.
    </div>
  </div>

</section>
